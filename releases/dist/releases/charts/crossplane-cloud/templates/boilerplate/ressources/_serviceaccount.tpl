{{- define "crossplane-cloud.serviceaccount" -}}
{{ $name := (coalesce .value.name .key) }}
apiVersion: iam.gcp.crossplane.io/v1alpha1
kind: ServiceAccount
metadata:
  name: {{ $name }}
  annotations:
    crossplane.io/external-name: {{ coalesce .value.externalName $name }}
spec:
  deletionPolicy: {{ coalesce .value.deletionPolicy "Orphan" }}
  forProvider:
    displayName: {{ coalesce .value.displayName $name }}
    description: "{{ coalesce .value.description (printf "SA generated by kube-core for: %s/%s/%s" .value.clusterName .value.namespace ( coalesce .value.mainReleaseName $name)) }}"
  providerConfigRef:
    name: gcp
{{- end }}